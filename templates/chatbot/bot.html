{% extends "base.html" %}
{% block title %}PlacementBot{% endblock %}
{% block page_title %}PlacementBot ‚Äì AI Assistant{% endblock %}

{% block content %}
<div class="chat-window">
    <div class="chat-header">
        <div
            style="width:40px;height:40px;background:rgba(255,255,255,.2);border-radius:50%;display:grid;place-items:center;font-size:1.2rem;">
            ü§ñ
        </div>
        <div>
            <div style="font-weight:700;color:#fff;font-size:.95rem;">PlacementBot</div>
            <div style="font-size:.72rem;color:rgba(255,255,255,.7);">‚óè Online ‚Äì Campus Career Assistant</div>
        </div>
    </div>

    <div class="chat-messages" id="chatMessages">
        <!-- Bot greeting -->
        <div class="chat-bubble bot">
            üëã Hello! I'm <strong>PlacementBot</strong>, your campus career assistant.<br><br>
            I can help you with:
            <ul style="margin:8px 0 0 16px;padding:0;font-size:.85rem;">
                <li>CGPA cutoffs &amp; eligibility</li>
                <li>Interview schedules &amp; venue</li>
                <li>How to apply for drives</li>
                <li>Resume download steps</li>
                <li>Alumni referrals &amp; mentorship</li>
            </ul><br>
            Type your question below! ‚¨áÔ∏è
        </div>
    </div>

    <div class="chat-input-area">
        <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything about placements..."
            onkeydown="if(event.key==='Enter'){sendMsg();}" />
        <button class="chat-send" onclick="sendMsg()">
            <i class="bi bi-send-fill"></i>
        </button>
    </div>
</div>

<!-- Sample Questions -->
<div class="mt-4" style="max-width:700px;margin:16px auto 0;">
    <p class="note mb-2">üí° Try asking:</p>
    <div class="d-flex flex-wrap gap-2">
        {% for q in [
        'What is the min CGPA?',
        'When is the next drive?',
        'How do I apply?',
        'Where is the interview?',
        'How to download resume?'
        ] %}
        <button onclick="quickAsk('{{ q }}')"
            style="background:rgba(79,70,229,.1);border:1px solid rgba(79,70,229,.3);color:var(--primary-light);padding:5px 14px;border-radius:20px;font-size:.78rem;cursor:pointer;transition:.2s;">
            {{ q }}
        </button>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const msgContainer = document.getElementById('chatMessages');
    const inputEl = document.getElementById('chatInput');

    function appendMsg(text, sender) {
        const div = document.createElement('div');
        div.className = `chat-bubble ${sender}`;
        div.innerHTML = text.replace(/\n/g, '<br>');
        msgContainer.appendChild(div);
        msgContainer.scrollTop = msgContainer.scrollHeight;
    }

    function appendTyping() {
        const div = document.createElement('div');
        div.className = 'chat-bubble bot';
        div.id = 'typing';
        div.innerHTML = '<i class="bi bi-three-dots"></i> typing‚Ä¶';
        msgContainer.appendChild(div);
        msgContainer.scrollTop = msgContainer.scrollHeight;
    }

    function removeTyping() {
        const t = document.getElementById('typing');
        if (t) t.remove();
    }

    async function sendMsg() {
        const msg = inputEl.value.trim();
        if (!msg) return;
        inputEl.value = '';
        appendMsg(msg, 'user');
        appendTyping();

        try {
            const res = await fetch('/chatbot/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: msg })
            });
            const data = await res.json();
            removeTyping();
            appendMsg(data.reply, 'bot');
        } catch {
            removeTyping();
            appendMsg('Oops! Something went wrong. Try again.', 'bot');
        }
    }

    function quickAsk(q) {
        inputEl.value = q;
        sendMsg();
    }
</script>
{% endblock %}