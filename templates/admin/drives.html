{% extends "base.html" %}
{% block title %}Placement Drives{% endblock %}
{% block page_title %}Placement Drives{% endblock %}
{% block content %}
<div class="pp-card mb-4">
    <h6 class="mb-3 gradient-text" style="font-weight:700;"><i class="bi bi-plus-circle me-2"></i>Create New Drive</h6>
    <form method="POST">
        <input type="hidden" name="action" value="create" />
        <div class="row g-3">
            <div class="col-md-4"><label class="pp-label">Company Name *</label>
                <input type="text" name="company_name" class="pp-input" placeholder="Google" required />
            </div>
            <div class="col-md-4"><label class="pp-label">Job Role *</label>
                <input type="text" name="job_role" class="pp-input" placeholder="Software Engineer" required />
            </div>
            <div class="col-md-4"><label class="pp-label">Package (LPA)</label>
                <input type="number" name="package_lpa" class="pp-input" placeholder="12" step="0.5" />
            </div>
            <div class="col-md-3"><label class="pp-label">Min CGPA *</label>
                <input type="number" name="min_cgpa" class="pp-input" value="6.0" step="0.1" min="0" max="10"
                    required />
            </div>
            <div class="col-md-3"><label class="pp-label">Max Backlogs</label>
                <input type="number" name="max_backlogs" class="pp-input" value="0" min="0" />
            </div>
            <div class="col-md-3"><label class="pp-label">Drive Date</label>
                <input type="date" name="drive_date" class="pp-input" />
            </div>
            <div class="col-md-3"><label class="pp-label">Venue</label>
                <input type="text" name="venue" class="pp-input" placeholder="Seminar Hall A" />
            </div>
            <div class="col-12">
                <label class="pp-label">Allowed Branches *</label>
                <div class="d-flex flex-wrap gap-3">
                    {% for br in branches %}
                    <div class="form-check" style="min-width:80px;">
                        <input class="form-check-input" type="checkbox" name="allowed_branches" value="{{ br }}"
                            id="br_{{ br }}">
                        <label class="form-check-label note" for="br_{{ br }}">{{ br }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="col-12"><label class="pp-label">Description</label>
                <textarea name="description" class="pp-textarea" rows="2" placeholder="Drive details..."></textarea>
            </div>
            <div class="col-12"><button type="submit" class="btn-pp-primary"><i
                        class="bi bi-plus-circle me-2"></i>Create Drive</button></div>
        </div>
    </form>
</div>

<div class="pp-card">
    <h6 class="mb-3" style="color:var(--text-muted);font-size:.8rem;text-transform:uppercase;letter-spacing:.08em;">All
        Drives ({{ drives|length }})</h6>
    {% if drives %}
    <div class="table-responsive">
        <table class="pp-table">
            <thead>
                <tr>
                    <th>Company</th>
                    <th>Role</th>
                    <th>Package</th>
                    <th>Min CGPA</th>
                    <th>Branches</th>
                    <th>Max BL</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Apps</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for d in drives %}
                <tr>
                    <td><strong>{{ d.company_name }}</strong></td>
                    <td>{{ d.job_role }}</td>
                    <td>{% if d.package_lpa %}₹{{ d.package_lpa }} LPA{% else %}—{% endif %}</td>
                    <td>{{ d.min_cgpa }}</td>
                    <td style="font-size:.75rem;max-width:140px;">{{ d.allowed_branches | join(', ') }}</td>
                    <td>{{ d.max_backlogs }}</td>
                    <td>{{ d.drive_date.strftime('%d %b %Y') if d.drive_date else '—' }}</td>
                    <td><span class="status-pill badge-{{ d.status }}">{{ d.status }}</span></td>
                    <td>{{ d.applicants }}</td>
                    <td>
                        <div class="d-flex gap-1 flex-wrap">
                            <form method="POST" style="display:inline;">
                                <input type="hidden" name="action" value="update_status" />
                                <input type="hidden" name="drive_id" value="{{ d.id }}" />
                                <select name="status" class="pp-select"
                                    style="padding:4px 8px;font-size:.75rem;width:auto;" onchange="this.form.submit()">
                                    {% for st in ['upcoming','ongoing','completed'] %}
                                    <option value="{{ st }}" {% if d.status==st %}selected{% endif %}>{{ st|title }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </form>
                            <form method="POST" onsubmit="return confirm('Delete this drive?')">
                                <input type="hidden" name="action" value="delete" />
                                <input type="hidden" name="drive_id" value="{{ d.id }}" />
                                <button class="btn-pp-danger" type="submit"><i class="bi bi-trash"></i></button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-center note py-4">No drives yet.</p>
    {% endif %}
</div>
{% endblock %}