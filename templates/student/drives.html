{% extends "base.html" %}
{% block title %}Live Drives{% endblock %}
{% block page_title %}Live Placement Drives{% endblock %}
{% block content %}
{% if not student or not student.branch %}
<div class="alert alert-warning mb-4">
    <i class="bi bi-exclamation-triangle me-2"></i>
    <a href="{{ url_for('student_profile') }}" style="color:inherit;font-weight:700;">Complete your profile</a> to see
    eligibility status.
</div>
{% endif %}
<div class="d-flex flex-column gap-3">
    {% if eligible_drives %}
    {% for d in eligible_drives %}
    <div class="pp-card"
        style="border-left:4px solid {% if d.is_eligible %}var(--success){% else %}var(--border){% endif %};">
        <div class="row align-items-center g-3">
            <div class="col-md-6">
                <div class="d-flex align-items-center gap-3">
                    <div class="stat-icon icon-indigo"
                        style="width:48px;height:48px;min-width:48px;font-size:1.2rem;border-radius:12px;"><i
                            class="bi bi-building"></i></div>
                    <div>
                        <strong style="font-size:1rem;">{{ d.company_name }}</strong>
                        <div class="note">{{ d.job_role }}</div>
                        {% if d.package_lpa %}<div style="color:var(--success);font-weight:700;font-size:.85rem;">₹{{
                            d.package_lpa }} LPA</div>{% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="note mb-1"><i class="bi bi-card-checklist me-1"></i>Min CGPA: <strong>{{ d.min_cgpa
                        }}</strong></div>
                <div class="note mb-1"><i class="bi bi-slash-circle me-1"></i>Max BL: <strong>{{ d.max_backlogs
                        }}</strong></div>
                <div class="note mb-1"><i class="bi bi-calendar me-1"></i>{{ d.drive_date.strftime('%d %b %Y') if
                    d.drive_date else 'TBD' }}</div>
                {% if d.venue %}<div class="note"><i class="bi bi-geo-alt me-1"></i>{{ d.venue }}</div>{% endif %}
            </div>
            <div class="col-md-3 text-md-end">
                <span class="status-pill badge-{{ d.status }}">{{ d.status }}</span>
                {% if d.is_eligible %}
                <span class="status-pill badge-selected ms-1" style="font-size:.68rem;">✓ Eligible</span>
                {% else %}
                <span class="status-pill badge-rejected ms-1" style="font-size:.68rem;">✗ Ineligible</span>
                {% endif %}
                <div class="mt-2">
                    {% if d.application %}
                    <span class="status-pill badge-{{ d.application.status }}">{{ d.application.status|replace('_','
                        ')|title }}</span>
                    {% elif d.is_eligible %}
                    <form method="POST" action="{{ url_for('student_apply', drive_id=d.id) }}">
                        <button type="submit" class="btn-pp-primary" style="padding:6px 18px;"><i
                                class="bi bi-send me-1"></i>Apply Now</button>
                    </form>
                    {% else %}
                    <button class="btn-pp-outline" disabled style="opacity:.4;cursor:not-allowed;">Not Eligible</button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% if d.description %}<div class="divider"></div>
        <p class="note mb-0">{{ d.description }}</p>{% endif %}
        <div class="mt-2"><span class="note"><i class="bi bi-diagram-3 me-1"></i>Allowed: {{ d.allowed_branches |
                join(', ') }}</span></div>
    </div>
    {% endfor %}
    {% else %}
    <div class="pp-card text-center py-5">
        <i class="bi bi-briefcase" style="font-size:3rem;color:var(--text-muted);"></i>
        <p class="note mt-3">No placement drives available. Check back soon!</p>
    </div>
    {% endif %}
</div>
{% endblock %}