<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block title %}PlacementPro{% endblock %} – Campus Career Suite</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet"/>
  {% block head %}{% endblock %}
</head>
<body>

{% if session.user_id %}
<!-- ════ SIDEBAR ════ -->
<nav class="sidebar" id="sidebar">
  <div class="sidebar-brand">
    <div class="brand-icon">
      <i class="bi bi-mortarboard-fill"></i>
    </div>
    <div>
      <div class="brand-title">PlacementPro</div>
      <div class="brand-sub">Campus Career Suite</div>
    </div>
  </div>

  <div class="sidebar-user">
    <div class="avatar">{{ session.user_name[0]|upper }}</div>
    <div class="user-info">
      <span class="user-name">{{ session.user_name }}</span>
      <span class="role-badge {{ session.role }}">{{ session.role|title }}</span>
    </div>
  </div>

  <ul class="sidebar-nav">
    <!-- Common -->
    {% if session.role == 'admin' %}
    <li class="nav-label">Admin Panel</li>
    <li><a href="{{ url_for('admin_dashboard') }}" class="nav-link {% if request.endpoint == 'admin_dashboard' %}active{% endif %}">
      <i class="bi bi-speedometer2"></i> Dashboard
    </a></li>
    <li><a href="{{ url_for('admin_drives') }}" class="nav-link {% if request.endpoint == 'admin_drives' %}active{% endif %}">
      <i class="bi bi-building"></i> Placement Drives
    </a></li>
    <li><a href="{{ url_for('admin_criteria') }}" class="nav-link {% if request.endpoint == 'admin_criteria' %}active{% endif %}">
      <i class="bi bi-funnel"></i> Criteria Engine
    </a></li>
    <li><a href="{{ url_for('admin_scheduler') }}" class="nav-link {% if request.endpoint == 'admin_scheduler' %}active{% endif %}">
      <i class="bi bi-calendar-check"></i> Interview Scheduler
    </a></li>
    <li><a href="{{ url_for('admin_applications') }}" class="nav-link {% if request.endpoint == 'admin_applications' %}active{% endif %}">
      <i class="bi bi-file-earmark-person"></i> Applications
    </a></li>
    <li><a href="{{ url_for('admin_analytics') }}" class="nav-link {% if request.endpoint == 'admin_analytics' %}active{% endif %}">
      <i class="bi bi-bar-chart-line"></i> Analytics
    </a></li>
    <li><a href="{{ url_for('admin_faqs') }}" class="nav-link {% if request.endpoint == 'admin_faqs' %}active{% endif %}">
      <i class="bi bi-chat-dots"></i> Bot FAQs
    </a></li>

    {% elif session.role == 'student' %}
    <li class="nav-label">Student Portal</li>
    <li><a href="{{ url_for('student_dashboard') }}" class="nav-link {% if request.endpoint == 'student_dashboard' %}active{% endif %}">
      <i class="bi bi-house"></i> Dashboard
    </a></li>
    <li><a href="{{ url_for('student_profile') }}" class="nav-link {% if request.endpoint == 'student_profile' %}active{% endif %}">
      <i class="bi bi-person-badge"></i> My Profile
    </a></li>
    <li><a href="{{ url_for('resume_wizard') }}" class="nav-link {% if request.endpoint == 'resume_wizard' %}active{% endif %}">
      <i class="bi bi-file-earmark-pdf"></i> Resume Wizard
    </a></li>
    <li><a href="{{ url_for('student_drives') }}" class="nav-link {% if request.endpoint == 'student_drives' %}active{% endif %}">
      <i class="bi bi-briefcase"></i> Live Drives
    </a></li>
    <li><a href="{{ url_for('student_applications') }}" class="nav-link {% if request.endpoint == 'student_applications' %}active{% endif %}">
      <i class="bi bi-clipboard-check"></i> Applications
    </a></li>
    <li><a href="{{ url_for('alumni_mentorship') }}" class="nav-link {% if request.endpoint == 'alumni_mentorship' %}active{% endif %}">
      <i class="bi bi-people"></i> Mentorship
    </a></li>

    {% elif session.role == 'alumni' %}
    <li class="nav-label">Alumni Portal</li>
    <li><a href="{{ url_for('alumni_dashboard') }}" class="nav-link {% if request.endpoint == 'alumni_dashboard' %}active{% endif %}">
      <i class="bi bi-house"></i> Dashboard
    </a></li>
    <li><a href="{{ url_for('alumni_referrals') }}" class="nav-link {% if request.endpoint == 'alumni_referrals' %}active{% endif %}">
      <i class="bi bi-person-plus"></i> Job Referrals
    </a></li>
    <li><a href="{{ url_for('alumni_mentorship') }}" class="nav-link {% if request.endpoint == 'alumni_mentorship' %}active{% endif %}">
      <i class="bi bi-calendar3"></i> Mentorship Slots
    </a></li>
    {% endif %}

    <!-- Common for all roles -->
    <li class="nav-label mt-2">Tools</li>
    <li><a href="{{ url_for('skill_gap') }}" class="nav-link {% if request.endpoint == 'skill_gap' %}active{% endif %}">
      <i class="bi bi-graph-up-arrow"></i> Skill Gap Analyzer
    </a></li>
    <li><a href="{{ url_for('chatbot') }}" class="nav-link {% if request.endpoint == 'chatbot' %}active{% endif %}">
      <i class="bi bi-robot"></i> PlacementBot
    </a></li>
  </ul>

  <div class="sidebar-footer">
    <a href="{{ url_for('logout') }}" class="btn btn-logout">
      <i class="bi bi-box-arrow-left"></i> Logout
    </a>
  </div>
</nav>

<!-- ════ TOPBAR ════ -->
<div class="main-content">
  <header class="topbar">
    <button class="sidebar-toggle" id="sidebarToggle">
      <i class="bi bi-list"></i>
    </button>
    <div class="topbar-title">{% block page_title %}Dashboard{% endblock %}</div>
    <div class="topbar-right">
      <a href="{{ url_for('chatbot') }}" class="btn btn-bot">
        <i class="bi bi-robot"></i> PlacementBot
      </a>
    </div>
  </header>

  <div class="page-content">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-container">
          {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </div>
</div>

{% else %}
<!-- Not logged in — full width -->
{% block full_content %}{% endblock %}
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<script>
  // Sidebar toggle
  const toggle = document.getElementById('sidebarToggle');
  const sidebar = document.getElementById('sidebar');
  const main    = document.querySelector('.main-content');
  if (toggle) {
    toggle.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      main.classList.toggle('expanded');
    });
  }
</script>
{% block scripts %}{% endblock %}
</body>
</html>
